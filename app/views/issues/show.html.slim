/= render partial: 'show', locals: { issue: @issue, board: @board, labels: @board_bag.labels }

.b-issue-modal[
  class="issue-#{@issue.number}"
  data-number="#{@issue.number}"
  data-direct_post_url="#{@direct_post.url}"
  data-direct_post_form_data="#{@direct_post.fields.to_json}"]
  = render partial: 'issues/labels', locals: { issue: @issue, board: @board }

  .content
    .issue-content
      .title.b-editable-form
        .issue-title = k(:issue, @issue).title
        a.url href="#{@issue.html_url}" target="_blank" ##{@issue.number}
        .due-date class="#{ :none unless @issue.due_date_at }" = k(:issue, @issue).due_date_at
        = simple_form_for :issue,
          url: update_board_issues_url(@board, @issue.number),
          remote: true,
          method: :post do |f|
          = f.input :title, label: false, as: :text
          = f.button :magic_submit, value: 'Update'

      .user-list
        = render partial: 'issues/assignee', locals: { issue: @issue }

      - unless @issue.archive?
        .move-to-column
          ul
            - @board.columns.each do |column|
              li data-column="#{column.id}" class="#{@issue.issue_stat.column_id == column.id ? 'active' : ''}"
                a data-remote="true" href="#{move_to_column_board_issues_url @board, @issue.number, column.id}" = column.name

      /.description.b-editable-form
        /.issue-description class="#{'blank' if k(:issue, @issue).body_empty?}"
          /= k(:issue, @issue).body_empty? ? 'Description' : markdown(@issue.body.html_safe, @board.github_url)

        /= simple_form_for :issue,
          /url: update_board_issues_url(@board, @issue.number),
          /remote: true,
          /method: :post do |f|
          /= f.input :body,
            /label: false,
            /as: :text,
            /input_html: { value: k(:issue, @issue).body_empty? ? '' : @issue.body, placeholder: 'Description' }
          /.actions
            /a.close-without-saving Close without saving
            /a.button.preview data-url="#{board_preview_url(@board)}" Preview
            /a.button.write Write
            /= f.button :magic_submit, value: 'Save'
        /= render partial: 'issues/upload'

      .issue-comments data-url="#{comments_board_issues_url @board, @issue.number}"
        - @comments.each do |comment|
          = render partial: 'comments/show', locals: { comment: comment, board: @board }

      - if can? :update, @board
        .b-editable-form.add-comment-form
          = simple_form_for :comment,
            url: "#{add_comment_board_issues_url(@board, @issue.number)}",
            remote: true,
            method: :post,
            html: { class: 'add-comment' } do |f|

            = f.input :body, label: false, as: :text, input_html: { placeholder: 'Add a new comment or upload an image…' }

            .actions
              /a.close-without-saving Close without saving
              /a.button.preview data-url="#{board_preview_url(@board)}" Preview
              /a.button.write Write

              = f.button :magic_submit, value: 'Comment', input_html: { class: 'add-comment-button' }

          = render partial: 'issues/upload'

          /form
            /.placeholder Add a comment or upload an image…
            /textarea
            /.preview-textarea
            /.controls
              /a.write Edit
              /a.preview data-url="#{board_preview_url}" Preview
              /a.button.save Save

    - if can? :update, @board
      .issue-actions
        = render partial: 'issues/actions/edit_labels',   locals: { board: @board, labels: @labels, issue: @issue }
        = render partial: 'issues/actions/assign',        locals: { issue: @issue }
        = render partial: 'issues/actions/edit_due_date', locals: { board: @board, issue: @issue }
        = render partial: 'issues/actions/close',         locals: { board: @board, issue: @issue }
        = render partial: 'issues/actions/archive',       locals: { board: @board, issue: @issue }

